---
layout: post
title: "[SpringBoot] JPA 연관관계 어노테이션"
tags: [Springboot]
date: 2023-06-23 11:49

categories : [SpringBoot, JPA]
toc:  true
toc_label: "JPA 연관관계 어노테이션"
---

## Intro
> 레거시를 사용할 때는 DB의 연관관계를 설정할 때 Foreign Key를 직접 설정하여 DB 관계를 설정하였고, JOIN을 할 때도 Mybatis를 사용했기에 직접 쿼리문을 작성하였다. 하지만, JPA에서 연관관계를 설정할 때 Entity 파일에 연관관계 어노테이션을 사용하여 설정할 수 있음을 배웠으며 연관관계를 단번에 이해하기 어려운 내용이므로 정리하고자 한다.

## 연관 관계
> 연관 관계 매핑을 하기 앞서, 연관 관계란 객체와 객체, 테이블과 테이블 간의 관계가 있는 것을 의미한다. 예를 들어 Member 객체(테이블)와 Board 객체(테이블)이 연관 관계를 가진다. 회원이 게시글을 작성하기에 서로의 관계를 맺을 필요가 있기에 이러한 객체(테이블)들을 연결하면 연관관계가 있다고 표현한다.

## 연관관계 고려 사항
> <span style ="color:#1E90FF">첫 번째로 방향이다.</span> 단방향인 지 양방향인 지 알아야 한다.<br> 
> <span style ="color:#1E90FF">두 번째로는 연관관계의 주인이다.</span> 양방향일 경우의 관리 주체가 누구인 지 고려해야 한다. <br>
> <span style ="color:#1E90FF">세 번째로는 다중성이다.</span> 다대다, 다대일, 일대일, 일대다 인지 정해야 한다.


### 1. 방향
- <span style ="color:#1E90FF">방향에는 단방향, 양방향이 존재한다.</span> DB에서는 Foreign Key를 설정하면 양 쪽 테이블 조인이 가능했기에 단방향 양방향을 구분할 필요가 없었다. 하지만 <span style ="color:#FF6347">객체는 참조용 필드가 있는 객체만 다른 객체를 참조하는 것이 가능하다.</span>
  - 예를 들어 설명하자면, Board(게시판) 객체가 작성자 정보가 필요하기에 Member의 Id 컬럼을 Board에 추가한다. 이 때 Member의 Id 필드가 참조용 컬럼이 되므로 Board가 Member와 연관관계를 맺었다고 할 수 있다. 반대로 Member에는 Board에 대한 컬럼을 추가하지 않았기에 Member가 Board를 조회할 수 없다.
  
  ```java
  @Entity
  public class Member {
      private Long id;
      private String MemberName;
      //Member는 자신과 연관된 Board를 알 수 없다.
  }

  @Entity
  public class Board {
      private Long id;
      //Board는 자신과 연관된 Member를 알고 있다.
      private Member member;
      private String title;
  }
  ```

- 위 예시에서 Member에 Board를 추가하면 양방향이 되는 것인가? 
  - 이를 정확하게 말하면 <span style ="color:#FF6347">객체에서는 양방향 연관관계라는 것이 없다. </span><span style ="color:#1E90FF">단지, 두 객체를 서로 단방향으로 설정하여 양방향인 것처럼 보이게 하는 것이다.</span>
- 모두 다 양방향 관계로 사용하면 안되는 것인가?
  - <span style ="color:#1E90FF">비즈니스 로직을 고려하여 참조가 필요한 경우에만 참조 컬럼을 추가하는 것이 좋다.</span>
  - User 객체의 경우는 대부분의 테이블과 연관관계를 가진다. 만약, 모두 양방향으로 연관관계를 걸게되면 굉장히 복잡도가 올라가게 된다. 그렇기에 <span style ="color:#FF6347">기본적으로 단방향 매핑을 한 후 역방향으로 참조가 반드시 필요할 때만 추가하는 것이 좋다.</span>

---

### 2. 연관관계 주인(feat. mappedBy)
- 두 객체의 관계 설정 시 연관관계 주인을 설정해야 한다.
- 두 객체를 서로 단방향으로 연결했을 때 외래키는 1개이므로 둘 중 하나의 객체에서 외래키를 관리해야 하는데, 이것을 연관관계의 주인이라 한다. <span style ="color:#1E90FF">즉, 주인이 외래키를 관리한다고 생각하면 된다.</span>
- <span style ="color:#1E90FF">연관관계 주인이 될 경우</span> 주인만 데이터베이스와 매핑되고 외래 키를 등록, 수정, 삭제를 할 수 있다.
- 반면, <span style ="color:#1E90FF">주인이 아닌 다른 객체의 경우는</span> 읽기만 할 수 있게 된다.
- 주인을 구별할 수 있게 mappedBy를 사용할 수 있다. mappedBy는 "이 컬럼은 연관관계의 주인이 아니다"를 선언하는 것으로 이제 다중성에서 나올 @OneToMany에서 사용할 수 있다.
  - ex) ```@OneToMany(mappedBy = "board")```
- mappedBy의 중요한 점은 <span style ="color:#FF6347">주인에 mappedBy를 사용하는 것이 아니라, 주인이 아닌 객체에 mappedBy속성을 사용하여 속성의 값으로 연관관계의 주인을 지정해야 한다.</span>



## 참고 사이트
[JPA 연관관계 총 정리 게시물](https://jeong-pro.tistory.com/231)<br>
[JPA 연관관계 참고 게시물](https://cjw-awdsd.tistory.com/47)<br>
[JPA 연관관계 참고 게시물2](https://zepettoworld.tistory.com/33)<br>


