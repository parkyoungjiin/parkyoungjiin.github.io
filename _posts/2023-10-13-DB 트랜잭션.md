---
layout: post
title: "[DB] DB 트랜잭션"
tags: [DB]
date: 2023-10-10 23:00
# last_modified_at: 2023-10-04 16:00

categories : [DB]
toc:  true
toc_label: "DB"
---

## Intro
> 원티드 백엔드 챌린지를 수행하면서 배웠던 내용을 정리한다.

## 트랜잭션(Transaction)
> 트랜잭션(Transaction), 데이터베이스의 상태를 변화시키기 위해 수행되는 작업의 단위를 의미한다.

### 트랜잭션(Transaction) 특징 - ACID
ACID는 데이터의 무결성과 안정성을 보장해준다.

1. 원자성(Atomcity) : 트랜잭션 작업이 모두 처리되거나 취소되어야 하는 성질이다.
   - 송금 시스템에서 10,000원을 송금했을 때 보낸 사람 계좌에서 10,000이 차감되고, 받는 사람의 계좌에서 10,000이 증가되야 한다.<br>
   - 만약, 보낸 사람의 계좌만 차감되고 받는 사람의 계좌는 증가되지 않는다면 엄청난 문제를 발생시킨다.<br>
   - 그렇기에 보낸 작업, 받는 작업 모두를 취소하고 새로운 송금(트랜잭션)을 해야 한다. 이를 ROLLBACK이라 한다.<br>
   - 원자성이란 트랜잭션 작업이 일부분만 처리되는 것을 방지해주는 성질이라고 생각하면 된다.

2. 일관성(Consistency) : 데이터베이스의 작업이 완료되면 일관적인 DB 상태를 유지하는 성질이다.
   - 예를 들어, A와 B가 서로에게 각각 다른 금액을 송금한다고 가정하자.
   - 서로 송금을 할 때 각자의 잔고를 확인하고 송금을 해야 한다.
   - 누군가 확인하지 않고 보내게 되면 일관성이 무너지게 된다. 그렇기에 제약 및 규칙을 따라야 한다.


3. 격리성(Isolation) : 트랜잭션은 독립적으로 수행되야 하는 성질이다. 
	- 즉, 격리성은 한 작업이 진행되고 있을 때 다른 작업이 끼어들지 못하는 성질이다. <br>
	- 예를 들어, 송금할 당시 10,000원이 잔고로 있어서 10,000을 송금하는데 동시에 자동 인출(통신비)된다고 가정하자.<br> 이 작업이 동시에 진행됨에 따라 잔고가 마이너스가 되는 현상이 발생한다. 그렇기에 격리성을 보장해야 한다.
	- 격리수준을 설정하여 위와 같은 문제를 해결할 수 있다.
      - Read Uncommitted : 한 트랜잭션 작업이 commit 되지 않아도 읽을 수 있는 수준
    		- Read Uncommitted를 설정하게 되면 Dirty Read, Non-repeatable Read, Phantom Read가 발생할 수 있다. (권장하지 않는 수준)
    	- Read Committed : commit 된 작업(변경된 작업)만 읽을 수 있는 수준
    		- 송금한다고 가정했을 때 상대방에게 입금되어 금액이 증가될 때까지 송금자의 트랜잭션에 영향을 미치지 않는다.
    	- Repeatable Read : 한 트랜잭션 작업이 종료될 때 까지 동일한 값을 반환하는 수준.(동일한 트랜잭션 내에서 동일한 값을 반환한다.)
    		- Repeatable Read 수준은 처음에 스냅샷으로 상태를 저장한다.
    		- 그리고 트랜잭션이 종료될 때까지 동일한 데이터를 리턴한다.
    		- 예를 들어, 잔고가 10,000이 있을 때 송금을 1,000원을 했다고 가정하자. 원래는 조회했을 때 9,000원이 나와야 하지만 10,000이 조회된다. 또한 누군가 송금을 하더라도 금액이 추가되지 않는다.
    	- Serialiable : 모든 트랜잭션 작업이 독립적으로 실행되는 수준.
    		- Seraliable은 모든 작업이 독립적으로 수행되면 격리성 보장은 된다. 하지만, 서비스 속도가 현저하게 저하될 것이다.
     
4. 지속성(Durability) : commit이 되면 트랜잭션은 DB에 영구적으로 반영되는 성질.
- 데이터베이스를 안전하게 보장하는 성질로, 예기치 않는 상황에서도 데이터의 영속성을 보장하는 성질이다.
- 계좌 이체를 성공적으로 마쳤으면 DB오류로 인해 종료되더라도 로그를 기록하여 이후 상황을 해결할 수 있다.




## 참고 사이트
[ACID 참고 사이트1](https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/)
[ACID 참고 사이트2](https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/)


